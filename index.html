<!DOCTYPE html>
<head>
    <title>Tennessee Plant Directory</title>
    <link href="assets/jquery.dynatable.css" rel="stylesheet" type="text/css" />
    <link href="assets/looks.css" rel="stylesheet" type="text/css" />
    <script src="assets/jquery-1.7.2.min.js" type="text/javascript"></script>
    <script src="assets/jquery.dynatable.js" type="text/javascript"></script>
</head>
<body>
    <h1>Tennessee Plant Directory</h1>
    <p>Data taken from the <a href="http://www.tva.gov/cgi-bin/plantDB/searchNativePlants.pl?showAll=1&sort=Common">Tennessee Valley Authority</a> website.  CSS and most of the javascript taken from <a href="http://dynatable.com">dynatable</a>.  The rest was hacked together by <a href="http://micha.gd">micha</a>.</p>

    <table id="plant-table">
        <thead>
            <th data-dynatable-column="common_name">Common Name</th>
            <th data-dynatable-column="scientific_name">Scientific Name</th>
            <th data-dynatable-column="native_region">Region</th>
            <th data-dynatable-column="light_preference">Light</th>
            <th data-dynatable-column="bloom_time">Bloom Time</th>
            <th data-dynatable-column="evergreen">Evergreen</th>
            <th data-dynatable-column="moisture_conditions">Moisture</th>
            <th data-dynatable-column="soil_ph">PH</th>
            <th data-dynatable-column="wildlife_value">Wildlife</th>
            <th data-dynatable-column="comments">Comments</th>
            <th data-dynatable-column="height_min">Min Height</th>
            <th data-dynatable-column="height_max">Max Height</th>
            <th data-dynatable-column="picture"></th>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script type="text/javascript">
        function attributeWriter(record) {
            var label = this.id;
            var raw = record[this.id];
            if (label == "picture") {
                return "<a href='" + raw + "'><img class='thumbnail' src='" + raw + "'></a>";
            } else if (label == "comments") {
                return "<div class=overflow>" + raw + "</div>";
            } else if (label == "common_name") {
                return "<a href='" + record.url + "'>" + raw + "</a>";
            }
            return raw;
        }

        function heightSort(a, b, attr, direction) {
            var a_height = a[attr];
            var b_height = b[attr];

            var a_num = Number(a_height.substr(0, a_height.length-1))
            var b_num = Number(b_height.substr(0, b_height.length-1))

            // Javascript hates infinites, so we just use 1e8 instead.  It's
            // close enough to infinity... right?
            if (isNaN(a_num)) {
                a_num = 1e8;
            }
            if (isNaN(b_num)) {
                b_num = 1e8;
            }

            console.log(a[attr], a_num);

            var comparison = a_num - b_num;
            return direction > 0 ? comparison : -comparison;
        }

        $.getJSON('plant_data.json', function(data) {
            $('#plant-table')
                .bind('dynatable:init', function(e, dynatable) {
                    dynatable.sorts.functions["heightSort"] = heightSort;
                })
                .dynatable({
                    dataset: {
                        records: data,
                        sortTypes: {
                            height_min: 'heightSort',
                            height_max: 'heightSort',
                        },
                        perPageOptions: [10, 25, 50, 100, 500],
                    } ,
                    writers: {
                        _attributeWriter: attributeWriter,
                    },
                });

        });

    </script>
</body>
